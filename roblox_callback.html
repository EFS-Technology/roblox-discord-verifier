<!DOCTYPE html>
<html>
  <body>
    <h1>Authorizing Roblox...</h1>
    <script>
      const code = new URLSearchParams(window.location.search).get("code");
      if (!code) {
        document.body.innerHTML = "<p>No Roblox code found.</p>";
        throw new Error("No code");
      }
      fetch(`/.netlify/functions/exchange?platform=roblox&code=${code}`)
        .then(r => r.json())
        .then(data => {
          if (!data.user || !data.user.id) throw new Error("No Roblox ID returned");
          localStorage.setItem("roblox_id", data.user.id);

          // Redirect to Discord OAuth
          const discordUrl = `https://discord.com/oauth2/authorize?client_id=YOUR_DISCORD_CLIENT_ID&response_type=code&redirect_uri=${encodeURIComponent(location.origin + '/discord_callback.html')}&scope=identify`;
          window.location.href = discordUrl;
        })
        .catch(err => {
          console.error("Roblox fetch error:", err);
          document.body.innerHTML = "<p>Error fetching Roblox ID</p>";
        });
    </script>
  </body>
</html>
